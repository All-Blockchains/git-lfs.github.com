var session_fetch=function(e,t,i){"use strict";var o=.4,r={use_html5_location:!1,ipinfodb_key:!1,gapi_location:!0,location_cookie:"location",location_cookie_timeout:5,session_timeout:32,session_cookie:"first_session",get_object:null,set_object:null},s=function(){if(e.session=e.session||{},e.session.contains=function(e){if("string"==typeof e)return-1!==this.indexOf(e);for(var t=0;t<e.length;t++)if(-1!==this.indexOf(e[t]))return!0;return!1},e.session&&e.session.options)for(var t in e.session.options)r[t]=e.session.options[t];var i={api_version:o,locale:c.locale(),current_session:c.session(),original_session:c.session(r.session_cookie,24*r.session_timeout*60*60*1e3),browser:c.browser(),plugins:c.plugins(),time:c.time(),device:c.device()};if(r.use_html5_location?i.location=c.html5_location():r.ipinfodb_key?i.location=c.ipinfodb_location(r.ipinfodb_key):r.gapi_location&&(i.location=c.gapi_location()),e.session&&e.session.start)var n=e.session.start;var s,a=0,l=function(t){t&&a--,0===a&&n&&n(e.session)};e.session={};for(var u in i)if(s=i[u],"function"==typeof s)try{s(function(t){e.session[u]=t,l(!0)}),a++}catch(g){e.console&&"function"==typeof console.log&&(console.log(g),l(!0))}else e.session[u]=s;l()},a={detect:function(){var e={browser:this.search(this.data.browser),version:this.search(i.userAgent)||this.search(i.appVersion),os:this.search(this.data.os)};if("Linux"==e.os)for(var t=["CentOS","Debian","Fedora","Gentoo","Mandriva","Mageia","Red Hat","Slackware","SUSE","Turbolinux","Ubuntu"],n=0;n<t.length;n++)if(i.userAgent.toLowerCase().match(t[n].toLowerCase())){e.distro=t[n];break}return e},search:function(e){if("object"!=typeof e){var t=e.indexOf(this.version_string);if(-1==t)return;return parseFloat(e.substr(t+this.version_string.length+1))}for(var i=0;i<e.length;i++){var n=e[i].string,o=e[i].prop;if(this.version_string=e[i].versionSearch||e[i].identity,n){if(-1!=n.indexOf(e[i].subString))return e[i].identity}else if(o)return e[i].identity}},data:{browser:[{string:i.userAgent,subString:"Chrome",identity:"Chrome"},{string:i.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:i.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:e.opera,identity:"Opera",versionSearch:"Version"},{string:i.vendor,subString:"iCab",identity:"iCab"},{string:i.vendor,subString:"KDE",identity:"Konqueror"},{string:i.userAgent,subString:"Firefox",identity:"Firefox"},{string:i.vendor,subString:"Camino",identity:"Camino"},{string:i.userAgent,subString:"Netscape",identity:"Netscape"},{string:i.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:i.userAgent,subString:"Trident",identity:"Explorer",versionSearch:"rv"},{string:i.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:i.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],os:[{string:i.platform,subString:"Win",identity:"Windows"},{string:i.platform,subString:"Mac",identity:"Mac"},{string:i.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:i.userAgent,subString:"iPad",identity:"iPad"},{string:i.userAgent,subString:"Android",identity:"Android"},{string:i.platform,subString:"Linux",identity:"Linux"}]}},c={browser:function(){return a.detect()},time:function(){var e=new Date,t=new Date;return e.setMonth(0),e.setDate(1),t.setMonth(6),t.setDate(1),{tz_offset:-(new Date).getTimezoneOffset()/60,observes_dst:e.getTimezoneOffset()!==t.getTimezoneOffset()}},locale:function(){var e=(i.language||i.browserLanguage||i.systemLanguage||i.userLanguage||"").split("-");return 2==e.length?{country:e[1].toLowerCase(),lang:e[0].toLowerCase()}:e?{lang:e[0].toLowerCase(),country:null}:{lang:null,country:null}},device:function(){var n,o,r={screen:{width:e.screen.width,height:e.screen.height}};try{n=e.innerWidth||t.documentElement.clientWidth||t.body.clientWidth}catch(s){n=0}try{o=e.innerHeight||t.documentElement.clientHeight||t.body.clientHeight}catch(s){o=0}return r.viewport={width:n,height:o},r.is_tablet=!!i.userAgent.match(/(iPad|SCH-I800|xoom|kindle)/i),r.is_phone=!r.is_tablet&&!!i.userAgent.match(/(iPhone|iPod|blackberry|android 0.5|htc|lg|midp|mmp|mobile|nokia|opera mini|palm|pocket|psp|sgh|smartphone|symbian|treo mini|Playstation Portable|SonyEricsson|Samsung|MobileExplorer|PalmSource|Benq|Windows Phone|Windows Mobile|IEMobile|Windows CE|Nintendo Wii)/i),r.is_mobile=r.is_tablet||r.is_phone,r},plugins:function(){var e=function(e){if(i.plugins){for(var t,n=0,o=i.plugins.length;o>n;n++)if(t=i.plugins[n],t&&t.name&&-1!==t.name.toLowerCase().indexOf(e))return!0;return!1}return!1},t=function(e){for(var t=!0,i=0;i<e.length;i++){try{var t=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash"+e[i]),!0)}catch(n){}if(t)return!0}return!1};return{flash:e("flash")||t([".7",".6",""]),silverlight:e("silverlight"),java:e("java"),quicktime:e("quicktime")}},session:function(i,n){var o=l.get_obj(i);if(null==o){o={visits:1,start:(new Date).getTime(),last_visit:(new Date).getTime(),url:e.location.href,path:e.location.pathname,referrer:t.referrer,referrer_info:l.parse_url(t.referrer),search:{engine:null,query:null}};var r,s=[{name:"Google",host:"google",query:"q"},{name:"Bing",host:"bing.com",query:"q"},{name:"Yahoo",host:"search.yahoo",query:"p"},{name:"AOL",host:"search.aol",query:"q"},{name:"Ask",host:"ask.com",query:"q"},{name:"Baidu",host:"baidu.com",query:"wd"}],a=s.length,c=0,u="q query term p wd query text".split(" ");for(c=0;a>c;c++)if(r=s[c],-1!==o.referrer_info.host.indexOf(r.host)){o.search.engine=r.name,o.search.query=o.referrer_info.query[r.query],o.search.terms=o.search.query?o.search.query.split(" "):null;break}if(null===o.search.engine&&o.referrer_info.search.length>1)for(c=0;c<u.length;c++){var g=o.referrer_info.query[u[c]];if(g){o.search.engine="Unknown",o.search.query=g,o.search.terms=g.split(" ");break}}}else o.prev_visit=o.last_visit,o.last_visit=(new Date).getTime(),o.visits++,o.time_since_last_visit=o.last_visit-o.prev_visit;return l.set_obj(i,o,n),o},html5_location:function(){return function(e){i.geolocation.getCurrentPosition(function(t){t.source="html5",e(t)},function(){r.gapi_location?c.gapi_location()(e):e({error:!0,source:"html5"})})}},gapi_location:function(){return function(t){var i=l.get_obj(r.location_cookie);i&&"google"===i.source?t(i):(e.gloader_ready=function(){"google"in e&&(e.google.loader.ClientLocation?(e.google.loader.ClientLocation.source="google",t(e.google.loader.ClientLocation)):t({error:!0,source:"google"}),l.set_obj(r.location_cookie,e.google.loader.ClientLocation,60*r.location_cookie_timeout*60*1e3))},l.embed_script("https://www.google.com/jsapi?callback=gloader_ready"))}},architecture:function(){var e=n.userAgent.match(/x86_64|Win64|WOW64|x86-64|x64\;|AMD64|amd64/)||"x64"===n.cpuClass?"x64":"x86";return{arch:e,is_x64:"x64"==e,is_x86:"x68"==e}},ipinfodb_location:function(t){return function(i){var n=l.get_obj(r.location_cookie);n||"ipinfodb"!==n.source?i(n):(e.ipinfocb=function(e){if("OK"===e.statusCode)e.source="ipinfodb",l.set_obj(r.location_cookie,e,60*r.location_cookie*60*1e3),i(e);else{if(r.gapi_location)return c.gapi_location()(i);i({error:!0,source:"ipinfodb",message:e.statusMessage})}},l.embed_script("http://api.ipinfodb.com/v3/ip-city/?key="+t+"&format=json&callback=ipinfocb"))}}},l={parse_url:function(e){var i=t.createElement("a"),n={};i.href=e;var o=i.search.substr(1);if(""!=o)for(var r,s=o.split("&"),a=0,c=s.length;c>a;a++)r=s[a].split("="),2===r.length&&(n[r[0]]=decodeURI(r[1]));return{host:i.host,path:i.pathname,protocol:i.protocol,port:""===i.port?80:i.port,search:i.search,query:n}},set_cookie:function(i,n,o,r){return i?(r||(r={}),(null===n||void 0===n)&&(o=-1),o&&(r.expires=(new Date).getTime()+o),t.cookie=[encodeURIComponent(i),"=",encodeURIComponent(String(n)),r.expires?"; expires="+new Date(r.expires).toUTCString():"","; path="+(r.path?r.path:"/"),r.domain?"; domain="+r.domain:"",e.location&&"https:"===e.location.protocol?"; secure":""].join("")):null},get_cookie:function(e,i){return(i=new RegExp("(?:^|; )"+encodeURIComponent(e)+"=([^;]*)").exec(t.cookie))?decodeURIComponent(i[1]):null},embed_script:function(e){var i=t.createElement("script");i.type="text/javascript",i.src=e,(t.body||t.getElementsByTagName("body")[0]||t.head).appendChild(i)},package_obj:function(e){if(e){e.version=o;var t=u.stringify(e);return delete e.version,t}},set_obj:function(e,t,i,n){l.set_cookie(e,l.package_obj(t),i,n)},get_obj:function(e){var t;try{t=u.parse(l.get_cookie(e))}catch(i){}return t&&t.version==o?(delete t.version,t):void 0}};null!=r.get_object&&(l.get_obj=r.get_object),null!=r.set_object&&(l.set_obj=r.set_object);var u={parse:e.JSON&&e.JSON.parse||function(e){return"string"==typeof e&&e?new Function("return "+e)():null},stringify:e.JSON&&e.JSON.stringify||function(e){var t=typeof e;if("object"===t&&null!==e){var i,n,o=[],r=e&&e.constructor===Array;for(i in e)n=e[i],t=typeof n,"string"===t?n='"'+n+'"':"object"===t&&null!==n&&(n=this.stringify(n)),o.push((r?"":'"'+i+'":')+n);return(r?"[":"{")+o.join(",")+(r?"]":"}")}return"string"===t?'"'+e+'"':void 0}};s()};"undefined"==typeof window.exports?session_fetch(window,document,navigator):window.exports.session=session_fetch;
